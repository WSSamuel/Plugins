"use strict";(self.webpackChunkmaxi_blocks=self.webpackChunkmaxi_blocks||[]).push([[4490],{94490:function(e,t,a){a.r(t);var s=a(51609),l=a(27723),c=a(47143),i=a(86087),n=a(94715),r=a(38443),o=a(56427),m=a(66087),d=a(26287),_=a(30181),u=a(87657),b=a(87747),y=a(62872),p=a(2521);const x=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,68145)))),k=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,71882)))),g=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,98279)))),v=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,33069)))),C=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,27261)))),E=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,41260)))),h=(0,d.Ay)((()=>a.e(9236).then(a.bind(a,19236)))),S=(0,d.Ay)((()=>Promise.resolve().then(a.bind(a,19780)))),f=(0,i.forwardRef)((({styleCards:e,setIsVisible:t},a)=>{const{isRTL:d,breakpoint:f,SCList:N,activeSCKey:O,activeSCValue:j,activeStyleCard:w,savedStyleCards:A,selectedSCKey:$,selectedSCValue:D}=(0,c.useSelect)((e=>{const{getEditorSettings:t}=e("core/editor"),{isRTL:a}=t(),{receiveMaxiDeviceType:s}=e("maxiBlocks"),l=s(),{receiveStyleCardsList:c,receiveMaxiActiveStyleCard:i,receiveSavedMaxiStyleCards:n,receiveMaxiSelectedStyleCard:r}=e("maxiBlocks/style-cards"),o=c(),m=i(),{key:d,value:_}=m,u=n(),b=r(),{key:y,value:p}=b;return{isRTL:a,breakpoint:l,SCList:o,activeSCKey:d,activeStyleCard:m,activeSCValue:_,savedStyleCards:u,selectedSCKey:y,selectedSCValue:p}})),{saveMaxiStyleCards:T,setActiveStyleCard:L,removeStyleCard:M,setSelectedStyleCard:P,saveSCStyles:V}=(0,c.useDispatch)("maxiBlocks/style-cards"),[K,B]=(0,i.useState)(`${j?.name} - `),[R,I]=(0,i.useState)("light"),q=(e=D)=>"user"===e?.type,[z,F]=(0,i.useState)(!q()),[G,U]=(0,i.useState)(!1),[J,Z]=(0,i.useState)((0,_.$4)(w,4));(0,i.useEffect)((()=>{if(D){(0,u.ki)(D,J),B(`${D?.name} - `);const e=q();F(!e),U(!1)}}),[$]);const H=t=>{const a={light:e[t].light.styleCard,dark:e[t].dark.styleCard},s={light:A[t]?.light.styleCard,dark:A[t]?.dark.styleCard};return!(0,m.isEqual)(a,s)||e[t]?.gutenberg_blocks_status!==A[t]?.gutenberg_blocks_status},Q=(t,a)=>{let s=Object.assign({},D);const l="typography"===Object.keys(t)[0],c=(0,b.GC)({obj:l?t.typography:t,attributes:Object.assign({},D[R].defaultStyleCard[a],D[R].styleCard[a]),defaultAttributes:D[R].defaultStyleCard[a],onChange:e=>e});Object.entries(c).forEach((([e,t])=>{l&&(0,m.isNil)(t)&&delete D[R].styleCard?.[a]?.[e],s=Object.assign({},s,{[R]:Object.assign({},s[R],{styleCard:Object.assign({},s[R].styleCard,{[a]:Object.assign({},s[R].styleCard[a],{[e]:t})})})})}));const i=Object.assign({},e,{[$]:Object.assign({},s)});T(i),(0,u.ki)(s,J)},[W]=(0,i.useState)(),X=t=>{const a=`sc_${(new Date).getTime()}`,s=(0,m.cloneDeep)(y?.sc_maxi),l=(0,m.cloneDeep)(t),c=(0,m.merge)(s,l),i=Object.assign({},e,{[a]:c});T(i,!0),(0,u.ki)(t,J),P(a)},Y=(0,i.useRef)();(0,i.useEffect)((()=>{Y?.current?.focus?.()}),[G]);const[ee,te]=(0,i.useState)(!1),[ae,se]=(0,i.useState)(!1),le=(0,r.date)((0,r.getSettings)()?.formats?.date),ce=(()=>{const t=[];return!(0,m.isEmpty)(e)&&Object.entries(e).map((([e,a],s)=>("user"!==a?.type?t.push({label:`${(0,l.__)("Template","maxi-blocks")}: ${a.name}`,value:e,status:a?.status,selected:a?.selected||!1}):(0,m.isEmpty)(a?.updated)?t.push({label:`${a.name}`,value:e,status:a?.status,selected:a?.selected||!1}):t.push({label:`${a.name} - ${a.updated}`,value:e,status:a?.status,selected:a?.selected||!1}),null))),t.sort(((e,t)=>e?.label?.includes("Template:")?1:t?.label?.includes("Template:")||e<t?-1:1)).sort(((e,t)=>{if(e?.label?.includes("Template:")||t?.label?.includes("Template:"))return null;const a=e?.label?.split("- ").pop(),s=t?.label?.split("- ").pop();return Date.parse(a)&&Date.parse(s)?new Date(s)-new Date(a):null}))})(),ie=ce[(e=>{let t="";return e.forEach(((e,a)=>{e.selected&&(t=a)})),t})(ce)],ne=ce[(e=>{let t="";return e.forEach(((e,a)=>{"active"===e.status&&(t=a)})),t})(ce)];return!(0,m.isEmpty)(e)&&(0,s.createElement)(o.Popover,{anchor:a.current,noArrow:!0,resize:!0,position:d?"bottom left right":"bottom right left",className:"maxi-style-cards__popover maxi-sidebar",focusOnMount:!0,strategy:"fixed"},(0,s.createElement)("div",{className:"active-style-card"},(0,s.createElement)("div",{className:"active-style-card_icon"},(0,s.createElement)(g,{icon:p.MG2})),(0,s.createElement)("div",{className:"active-style-card_title"},(0,s.createElement)("span",null,(0,l.__)("Active style card","maxi-blocks")),(0,s.createElement)("h2",{className:"maxi-style-cards__popover__title"},w.value.name,W&&(0,s.createElement)("span",null,"| ",W))),(0,s.createElement)("span",{className:"maxi-responsive-close has-tooltip",onClick:()=>t(!1)},(0,s.createElement)("span",{className:"tooltip"},(0,l.__)("Close","maxi-blocks")),(0,s.createElement)(g,{icon:p.utg}))),(0,s.createElement)("div",{className:"maxi-style-cards__sc"},(0,s.createElement)("div",{className:"maxi-style-cards__sc__more-sc"},(0,s.createElement)(S,{type:"sc"}),(0,s.createElement)(n.MediaUploadCheck,null,(0,s.createElement)(n.MediaUpload,{onSelect:e=>{fetch(e.url).then((e=>e.json())).then((e=>JSON.parse(e))).then((e=>{N.map((e=>e.label)).filter((e=>e)).indexOf(e.name)<0?(X(e),se(!1),te(!1)):se(!0)})).catch((e=>{console.error(e)}))},allowedTypes:"text",render:({open:e})=>(0,s.createElement)(x,{className:"maxi-style-cards__sc__ie--import",onClick:e},(0,l.__)("Import","maxi-blocks"))})),(0,s.createElement)("div",{className:"maxi-style-cards__sc__ie"},(0,s.createElement)(x,{className:"maxi-style-cards__sc__ie--export",disabled:!1,onClick:()=>{const e=`${D.name}_exported.txt`;(0,_.Ik)(Object.assign({},D,{name:`${D.name} exported`,status:""}),e)}},(0,l.__)("Export","maxi-blocks")))),(0,s.createElement)("div",{className:"maxi-style-cards__active-edit"},(0,s.createElement)("div",{className:"maxi-style-cards__active-edit-title"},(0,s.createElement)("h3",null,(0,l.__)("Style card editor","maxi-blocks")),(0,s.createElement)("span",null,(0,l.__)("Preview, edit or activate style card","maxi-blocks"))),ae&&(0,s.createElement)("div",{className:"maxi-style-cards__card-already-exists"},(0,s.createElement)("span",null,(0,l.__)("Imported card already exists.","maxi-blocks"))),(0,s.createElement)("div",{className:"maxi-style-cards__active-edit-options"},(0,s.createElement)("div",{className:"maxi-style-cards__sc__more-sc--select"},(0,s.createElement)(E,{options:ce,value:ie||ne,placeholder:(0,l.__)("Type to searchâ€¦","maxi-blocks"),onChange:t=>{const a=t?.value;P(a);const s=e?.[a];!q(s)&&(()=>{const e=document.getElementsByClassName("maxi-style-cards__settings")[0],t=e?.getElementsByClassName("maxi-accordion-control__item");if(!t||(0,m.isEmpty)(t))return null;for(const e of t)e.querySelector("[aria-expanded=true]")?.click()})()},hideSelectedOptions:!0,noOptionsMessage:()=>null})),(0,s.createElement)(k,{message:(0,l.__)(`Deleting ${D.name} style card. This action is permanent.`,"maxi-blocks"),cancelLabel:(0,l.__)("Cancel","maxi-blocks"),confirmLabel:(0,l.__)("Delete","maxi-blocks"),onConfirm:()=>{M($),O===$&&L("sc_maxi")},buttonDisabled:!((e,t)=>"sc_maxi"!==e&&e!==t)($,O),buttonClassName:"maxi-style-cards__sc__more-sc--delete has-tooltip",buttonChildren:(0,s.createElement)(s.Fragment,null,(0,s.createElement)("span",{className:"tooltip"},(0,l.__)("Delete","maxi-blocks")),(0,s.createElement)(g,{icon:p.EZt}))}))),(0,s.createElement)("div",{className:"maxi-style-cards__sc__actions edit-activate"},(0,s.createElement)(x,{className:"maxi-style-cards-customise-card-button",onClick:()=>U(!G)},z&&(0,l.__)("Customise card","maxi-blocks"),!z&&(0,l.__)("Copy card","maxi-blocks")),!z&&(0,s.createElement)(x,{className:"maxi-style-cards__sc__actions--save",disabled:!H($),onClick:()=>{const t="active"===D?.status,a=Object.assign({},e,{[$]:Object.assign({},D,{status:t?"active":""})});t&&(Z((0,_.$4)(D,4)),(0,u.ki)(D,(0,_.$4)(D,4))),T(a,!0),V(t)}},(0,l.__)("Save changes","maxi-blocks")),(0,s.createElement)(k,{message:(0,l.__)(`Activate new style. Customized blocks will not change. All other Maxi blocks will get new, "${D.name}" styles.`,"maxi-blocks"),cancelLabel:(0,l.__)("Cancel","maxi-blocks"),confirmLabel:(0,l.__)("Activate","maxi-blocks"),onConfirm:()=>{L($),T(D),(0,u.ki)(D,(0,_.$4)(D,4)),Z((0,_.$4)(D,4));const t=(0,m.cloneDeep)(e);Object.entries(t).forEach((([e,a])=>{t[e]=e===$?Object.assign({},a,{status:"active"}):Object.assign({},a,{status:""})})),T(t,!0),V(!0)},buttonDisabled:!((e,t)=>!(!H(e)&&e===t))($,O),buttonClassName:"maxi-style-cards__sc__actions--apply",buttonChildren:(0,s.createElement)(s.Fragment,null,(z||!H($))&&(0,l.__)("Activate now","maxi-blocks"),!z&&H($)&&(0,l.__)("Save and activate now","maxi-blocks"))})),!z&&(0,s.createElement)(C,{label:(0,l.__)("Style core blocks within Maxi containers","maxi-blocks"),selected:D.gutenberg_blocks_status,onChange:t=>(t=>{const a=Object.assign({},e,{[$]:Object.assign({},D,{gutenberg_blocks_status:t})});T(a),(0,u.ki)(a[$],J)})(t)})),(0,s.createElement)("div",{className:"maxi-style-cards__sc maxi-style-cards__settings"},G&&(0,s.createElement)("div",{className:"maxi-style-cards__sc-custom-name"},(0,s.createElement)("h3",null,(0,l.__)("Create new style from","maxi-blocks"),(0,s.createElement)("b",null," ",D.name)),(0,s.createElement)("div",{className:"maxi-style-cards__sc__save"},(0,s.createElement)("input",{type:"text",maxLength:"35",placeholder:(0,l.__)("Short memorable name*","maxi-blocks"),value:K,onChange:e=>{B(e.target.value),te(!1)},ref:Y}),(0,s.createElement)(x,{disabled:(0,m.isEmpty)(K),onClick:()=>{if(N.map((e=>e.label)).filter((e=>e)).indexOf(K)>=0)te(!0);else{te(!1),se(!1);const e={name:K,status:"",gutenberg_blocks_status:!("gutenberg_blocks_status"in D)||D.gutenberg_blocks_status,dark:{defaultStyleCard:Object.assign({},D.dark.defaultStyleCard,D.dark.styleCard),styleCard:{}},light:{defaultStyleCard:Object.assign({},D.light.defaultStyleCard,D.light.styleCard),styleCard:{}},type:"user",updated:le};X(e),U(!1)}}},(0,l.__)("Create","maxi-blocks")),(0,s.createElement)(x,{onClick:()=>U(!1)},(0,l.__)("Cancel","maxi-blocks"))),ee&&(0,s.createElement)("div",{className:"maxi-style-cards__card-already-exists create-new-section"},(0,s.createElement)("span",null,(0,l.__)("A card with this name already exists.")))),(0,s.createElement)("div",{className:z?"maxi-style-card-settings-disabled":"maxi-style-card-settings"},(0,s.createElement)(v,{disablePadding:!0,returnValue:({key:e})=>I(e),items:[{label:(0,l.__)("Light tone globals","maxi-blocks"),key:"light",content:(0,s.createElement)(h,{SC:D.light,SCStyle:"light",onChangeValue:Q,breakpoint:f,currentKey:$})},{label:(0,l.__)("Dark tone globals","maxi-blocks"),key:"dark",content:(0,s.createElement)(h,{SC:D.dark,SCStyle:"dark",onChangeValue:Q,breakpoint:f,currentKey:$})}]}))))}));t.default=f}}]);